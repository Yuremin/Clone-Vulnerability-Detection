static int CVE_2014_0155_VULN_ioapic_deliver(struct kvm_ioapic *ioapic, int irq, bool line_status)
{

	union kvm_ioapic_redirect_entry *entry = &ioapic->redirtbl[irq];
	struct kvm_lapic_irq type2Clone_1;
	int ret;

	ioapic_debug("dest=%x dest_mode=%x delivery_mode=%x "
		     "vector=%x trig_mode=%x\n",
		     entry->fields.dest_id, entry->fields.dest_mode,
		     entry->fields.delivery_mode, entry->fields.vector,
		     entry->fields.trig_mode);

	type2Clone_1.dest_id = entry->fields.dest_id;
	type2Clone_1.vector = entry->fields.vector;
	type2Clone_1.dest_mode = entry->fields.dest_mode;
	type2Clone_1.trig_mode = entry->fields.trig_mode;
	type2Clone_1.delivery_mode = entry->fields.delivery_mode << 8;
	type2Clone_1.level = 1;
	type2Clone_1.shorthand = 0;

	if (irq == RTC_GSI && line_status) {
		BUG_ON(ioapic->rtc_status.pending_eoi != 0);
		ret = kvm_irq_delivery_to_apic(ioapic->kvm, NULL, &type2Clone_1,
				ioapic->rtc_status.dest_map);
		ioapic->rtc_status.pending_eoi = ret;
	} else
		ret = kvm_irq_delivery_to_apic(ioapic->kvm, NULL, &type2Clone_1, NULL);

	return ret;

}