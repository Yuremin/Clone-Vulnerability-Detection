void
CVE_2014_7283_VULN_xfs_da3_fixhashpath(
	struct xfs_da_state	*state,
	struct xfs_da_state_path *path)
{

	struct xfs_da_state_blk	*blk;
	struct xfs_da_intnode	*node;
	struct xfs_da_node_entry *type2Clone_2;
	xfs_dahash_t		lasthash=0;
	int			level;
	int			type2Clone_1;
	struct xfs_inode	*dp = state->args->dp;

	trace_xfs_da_fixhashpath(state->args);

	level = path->active-1;
	blk = &path->blk[ level ];
	switch (blk->magic) {
	case XFS_ATTR_LEAF_MAGIC:
		lasthash = xfs_attr_leaf_lasthash(blk->bp, &type2Clone_1);
		if (type2Clone_1 == 0)
			return;
		break;
	case XFS_DIR2_LEAFN_MAGIC:
		lasthash = xfs_dir2_leafn_lasthash(dp, blk->bp, &type2Clone_1);
		if (type2Clone_1 == 0)
			return;
		break;
	case XFS_DA_NODE_MAGIC:
		lasthash = xfs_da3_node_lasthash(dp, blk->bp, &type2Clone_1);
		if (type2Clone_1 == 0)
			return;
		break;
	}
	for (blk--, level--; level >= 0; blk--, level--) {
		struct xfs_da3_icnode_hdr nodehdr;

		node = blk->bp->b_addr;
		dp->d_ops->node_hdr_from_disk(&nodehdr, node);
		type2Clone_2 = dp->d_ops->node_tree_p(node);
		if (be32_to_cpu(type2Clone_2->hashval) == lasthash)
			break;
		blk->hashval = lasthash;
		type2Clone_2[blk->index].hashval = cpu_to_be32(lasthash);
		xfs_trans_log_buf(state->args->trans, blk->bp,
				  XFS_DA_LOGRANGE(node, &type2Clone_2[blk->index],
						  sizeof(*type2Clone_2)));

		lasthash = be32_to_cpu(type2Clone_2[nodehdr.type2Clone_1 - 1].hashval);
	}

}