static int CVE_2014_5271_VULN_encode_slice(AVCodecContext *avctx, const AVFrame *pic,
                        PutBitContext *pb,
                        int sizes[4], int x, int y, int quant,
                        int mbs_per_slice)
{

    ProresContext *ctx = avctx->priv_data;
    int i, type2Clone_3, type2Clone_1;
    int total_size = 0;
    const uint16_t *src;
    int slice_width_factor = av_log2(mbs_per_slice);
    int type2Clone_4, pwidth, type2Clone_2, line_add;
    int plane_factor, is_chroma;
    uint16_t *qmat;

    if (ctx->pictures_per_frame == 1)
        line_add = 0;
    else
        line_add = ctx->cur_picture_idx ^ !pic->top_field_first;

    if (ctx->force_quant) {
        qmat = ctx->quants[0];
    } else if (quant < MAX_STORED_Q) {
        qmat = ctx->quants[quant];
    } else {
        qmat = ctx->custom_q;
        for (i = 0; i < 64; i++)
            qmat[i] = ctx->quant_mat[i] * quant;
    }

    for (i = 0; i < ctx->num_planes; i++) {
        is_chroma    = (i == 1 || i == 2);
        plane_factor = slice_width_factor + 2;
        if (is_chroma)
            plane_factor += ctx->chroma_factor - 3;
        if (!is_chroma || ctx->chroma_factor == CFACTOR_Y444) {
            type2Clone_3          = x << 4;
            type2Clone_1          = y << 4;
            type2Clone_4 = 4;
            pwidth      = avctx->width;
        } else {
            type2Clone_3          = x << 3;
            type2Clone_1          = y << 4;
            type2Clone_4 = 2;
            pwidth      = avctx->width >> 1;
        }

        type2Clone_2 = pic->type2Clone_2[i] * ctx->pictures_per_frame;
        src = (const uint16_t*)(pic->data[i] + type2Clone_1 * type2Clone_2 +
                                line_add * pic->type2Clone_2[i]) + type2Clone_3;

        if (i < 3) {
            get_slice_data(ctx, src, type2Clone_2, type2Clone_3, type2Clone_1,
                           pwidth, avctx->height / ctx->pictures_per_frame,
                           ctx->blocks[0], ctx->emu_buf,
                           mbs_per_slice, type2Clone_4, is_chroma);
            sizes[i] = encode_slice_plane(ctx, pb, src, type2Clone_2,
                                          mbs_per_slice, ctx->blocks[0],
                                          type2Clone_4, plane_factor,
                                          qmat);
        } else {
            get_alpha_data(ctx, src, type2Clone_2, type2Clone_3, type2Clone_1,
                           pwidth, avctx->height / ctx->pictures_per_frame,
                           ctx->blocks[0], mbs_per_slice, ctx->alpha_bits);
            sizes[i] = encode_alpha_plane(ctx, pb, src, type2Clone_2,
                                          mbs_per_slice, ctx->blocks[0],
                                          quant);
        }
        total_size += sizes[i];
    }
    return total_size;

}