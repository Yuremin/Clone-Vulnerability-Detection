static int CVE_2012_6617_VULN_prepare_sdp_description(FFStream *stream, uint8_t **pbuffer,
                                   struct in_addr my_ip)
{

    AVFormatContext *type2Clone_1;
    AVStream *avs = NULL;
    int i;

    type2Clone_1 =  avformat_alloc_context();
    if (type2Clone_1 == NULL) {
        return -1;
    }
    av_dict_set(&type2Clone_1->metadata, "title",
               stream->title[0] ? stream->title : "No Title", 0);
    type2Clone_1->nb_streams = stream->nb_streams;
    if (stream->is_multicast) {
        snprintf(type2Clone_1->filename, 1024, "rtp://%s:%d?multicast=1?ttl=%d",
                 inet_ntoa(stream->multicast_ip),
                 stream->multicast_port, stream->multicast_ttl);
    } else {
        snprintf(type2Clone_1->filename, 1024, "rtp://0.0.0.0");
    }

    if (type2Clone_1->nb_streams >= INT_MAX/sizeof(*type2Clone_1->streams) ||
        !(type2Clone_1->streams = av_malloc(type2Clone_1->nb_streams * sizeof(*type2Clone_1->streams))))
        goto sdp_done;
    if (type2Clone_1->nb_streams >= INT_MAX/sizeof(*avs) ||
        !(avs = av_malloc(type2Clone_1->nb_streams * sizeof(*avs))))
        goto sdp_done;

    for(i = 0; i < stream->nb_streams; i++) {
        type2Clone_1->streams[i] = &avs[i];
        type2Clone_1->streams[i]->codec = stream->streams[i]->codec;
    }
    *pbuffer = av_mallocz(2048);
    av_sdp_create(&type2Clone_1, 1, *pbuffer, 2048);

 sdp_done:
    av_free(type2Clone_1->streams);
    av_dict_free(&type2Clone_1->metadata);
    av_free(type2Clone_1);
    av_free(avs);

    return strlen(*pbuffer);

}